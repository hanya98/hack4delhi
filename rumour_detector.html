<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Delhi Policy Rumour Detector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5ede3;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .wrapper {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            background-color: #fff8f0;
            border-left: 6px solid #a74432;
            padding: 30px 35px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            flex: 1;
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .logo-section {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .logo {
            font-size: 36px;
            color: #a74432;
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            color: #000;
            margin-bottom: 2px;
        }
        
        .logo-text p {
            font-size: 13px;
            color: #666;
            line-height: 1.3;
        }
        
        .header-hindi {
            font-size: 18px;
            font-weight: 600;
            color: #a74432;
            margin-bottom: 8px;
            letter-spacing: 0.3px;
        }
        
        .tabs-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .tab-card {
            background: white;
            border: 2px solid #e8dcc8;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            border-left: 4px solid #a74432;
        }
        
        .tab-card:hover {
            border-color: #a74432;
            box-shadow: 0 4px 12px rgba(167, 68, 50, 0.15);
            transform: translateY(-2px);
        }
        
        .tab-card.active {
            background: linear-gradient(135deg, #fff8f0 0%, #faf3eb 100%);
            border-color: #a74432;
            box-shadow: 0 4px 12px rgba(167, 68, 50, 0.15);
        }
        
        .tab-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .tab-label {
            font-size: 13px;
            color: #555;
            line-height: 1.4;
            font-weight: 500;
        }
        
        .main-content {
            background: white;
            border-radius: 8px;
            padding: 35px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e8dcc8;
        }
        
        .input-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            display: block;
        }
        
        .input-sublabel {
            font-size: 13px;
            color: #888;
            margin-bottom: 15px;
            display: block;
        }
        
        textarea {
            width: 100%;
            min-height: 140px;
            padding: 15px;
            border: 2px solid #e8dcc8;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Segoe UI', sans-serif;
            resize: vertical;
            line-height: 1.5;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #a74432;
            background: #fffbf7;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn-search {
            flex: 1;
            padding: 14px 20px;
            background: #a74432;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-search:hover {
            background: #8a3729;
            box-shadow: 0 4px 12px rgba(167, 68, 50, 0.25);
            transform: translateY(-1px);
        }
        
        .btn-search:active {
            transform: translateY(0);
        }
        
        .chat-box {
            margin-top: 25px;
            background: #faf8f5;
            border-radius: 8px;
            border: 1px solid #e8dcc8;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 350px;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages::-webkit-scrollbar-track {
            background: #f0ebe3;
        }
        
        .messages::-webkit-scrollbar-thumb {
            background: #c9b8a6;
            border-radius: 3px;
        }
        
        .msg {
            display: flex;
            margin-bottom: 3px;
            animation: msgSlide 0.25s ease;
        }
        
        @keyframes msgSlide {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .msg.user {
            justify-content: flex-end;
        }
        
        .msg-text {
            max-width: 72%;
            padding: 11px 15px;
            border-radius: 8px;
            word-wrap: break-word;
            line-height: 1.45;
            font-size: 13px;
        }
        
        .msg.bot .msg-text {
            background: #ede9e1;
            color: #333;
            border-left: 3px solid #a74432;
        }
        
        .msg.user .msg-text {
            background: #a74432;
            color: white;
            border-radius: 8px 2px 8px 8px;
        }
        
        .loading {
            text-align: center;
            padding: 15px 20px;
            color: #999;
            display: none;
            font-size: 13px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 2px solid #f0ebe3;
            border-top: 2px solid #a74432;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 0.6s linear infinite;
            margin: 0 auto 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-right {
                margin-top: 15px;
            }
            
            .tabs-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .msg-text {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
<div class="wrapper">
    <div class="header">
        <div class="header-left">
            <div class="header-hindi">‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§®‡•Ä‡§§‡§ø ‡§Ö‡§´‡§µ‡§æ‡§π ‡§°‡§ø‡§ü‡•á‡§ï‡•ç‡§ü‡§∞</div>
            <div class="logo-section">
                <div class="logo">üìã</div>
                <div class="logo-text">
                    <h1>Delhi Policy Rumour Detector</h1>
                    <p>‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§®‡§ø‡§µ‡§æ‡§∏‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§®‡•Ä‡§§‡§ø ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è</p>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div>üáÆüá≥ ‡§≠‡§æ‡§∞‡§§</div>
            <div>üìç ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä NCR</div>
        </div>
    </div>
    
    <div class="tabs-container">
        <div class="tab-card active" onclick="switchTab(0)">
            <div class="tab-icon">üìã</div>
            <div class="tab-label">‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç<br>Schemes</div>
        </div>
        <div class="tab-card" onclick="switchTab(1)">
            <div class="tab-icon">üìÑ</div>
            <div class="tab-label">‡§®‡•Ä‡§§‡§ø‡§Ø‡§æ‡§Ç<br>Policies</div>
        </div>
        <div class="tab-card" onclick="switchTab(2)">
            <div class="tab-icon">üèõÔ∏è</div>
            <div class="tab-label">‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§ñ‡§¨‡§∞<br>Govt News</div>
        </div>
        <div class="tab-card" onclick="switchTab(3)">
            <div class="tab-icon">üì∞</div>
            <div class="tab-label">‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞<br>News</div>
        </div>
    </div>
    
    <div class="main-content">
        <label class="input-label">‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä/‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§®‡•Ä‡§§‡§ø, ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø‡§ï ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§¶‡•á‡§π ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</label>
        <label class="input-sublabel">Enter message about Delhi/India policy, scheme, or bill</label>
        
        <textarea id="userInput" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: MNREGA ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à? ‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à? ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?\nExample: What is MNREGA? Is it removed? Who is CM of Delhi?"></textarea>
        
        <div class="button-group">
            <button class="btn-search" onclick="sendQuery()">
                üîç ‡§≤‡§æ‡§á‡§µ ‡§µ‡•á‡§¨ ‡§ñ‡•ã‡§ú ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç / Verify with Live Web Search
            </button>
        </div>
        
        <div class="chat-box">
            <div class="messages" id="messages"></div>
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <span>‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç... / Please wait...</span>
            </div>
        </div>
    </div>
</div>

<script>
    const GEMINI_API_KEY = 'AIzaSyBw2gp9ovaWkPTmdxb7EKDI_cF1jbhNvF0';
    const SERP_API_KEY = 'fa56797b2e8857d005bc131a33d2416a0b4b4f16fcf3afcf8ea822b765cd1cd4';
    
    let currentTab = 0;
    let messageHistory = [];
    
    function switchTab(tabIdx) {
        let cards = document.querySelectorAll('.tab-card');
        cards.forEach((card, idx) => {
            if (idx === tabIdx) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        });
        currentTab = tabIdx;
    }
    
    function sendQuery() {
        let input = document.getElementById('userInput').value.trim();
        
        if (!input) {
            alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•Å‡§õ ‡§≤‡§ø‡§ñ‡•á‡§Ç / Please type something first');
            return;
        }
        
        addMessage(input, 'user');
        document.getElementById('userInput').value = '';
        document.getElementById('loadingDiv').classList.add('show');
        
        processQuery(input);
    }
    
    function addMessage(text, sender) {
        let messagesDiv = document.getElementById('messages');
        let msgDiv = document.createElement('div');
        msgDiv.className = 'msg ' + sender;
        
        let textDiv = document.createElement('div');
        textDiv.className = 'msg-text';
        textDiv.textContent = text;
        
        msgDiv.appendChild(textDiv);
        messagesDiv.appendChild(msgDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function processQuery(query) {
        // First get web search results from SERP API
        getWebSearchResults(query).then(searchResults => {
            // Then use Gemini to analyze with web search context
            queryGeminiWithContext(query, searchResults);
        }).catch(err => {
            // Fallback to just Gemini if SERP fails
            queryGeminiWithContext(query, '');
        });
    }
    
    function getWebSearchResults(query) {
        return fetch(`https://api.serpapi.com/search?q=${encodeURIComponent(query)}&api_key=${SERP_API_KEY}&gl=in`, {
            method: 'GET'
        })
        .then(resp => resp.json())
        .then(data => {
            if (data.organic_results) {
                return data.organic_results.slice(0, 3).map(r => `${r.title}: ${r.snippet}`).join('\n\n');
            }
            return '';
        })
        .catch(err => {
            console.log('SERP failed, using Gemini only');
            return '';
        });
    }
    
    function queryGeminiWithContext(query, webContext) {
        let systemPrompt = `You are a helpful assistant specialized in answering questions about Delhi and Indian government policies, schemes, subsidies, and news. You have access to current web search results. Your task is to provide accurate, factual information.
        
You can answer questions in both Hindi and English. Provide clear, structured responses with relevant details.
        
Web Search Results:\n${webContext ? webContext : 'No web results available'}
        
Based on your knowledge and the above search results, answer the user's question accurately and comprehensively.`;
        
        let payload = {
            contents: [
                {
                    parts: [
                        { text: systemPrompt + '\n\nUser Question: ' + query }
                    ]
                }
            ]
        };
        
        fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        })
        .then(resp => resp.json())
        .then(data => {
            document.getElementById('loadingDiv').classList.remove('show');
            
            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                let reply = data.candidates[0].content.parts[0].text;
                addMessage(reply, 'bot');
            } else if (data.error) {
                addMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + data.error.message + ' / Error: ' + data.error.message, 'bot');
            } else {
                addMessage('‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•à‡§Ç ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á ‡§∏‡§ï‡§æ‡•§ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§ / Sorry, I could not process that. Try again.', 'bot');
            }
        })
        .catch(err => {
            document.getElementById('loadingDiv').classList.remove('show');
            addMessage('‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø / Network error: ' + err.message, 'bot');
        });
    }
</script>
</body>
</html>
